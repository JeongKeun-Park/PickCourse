(function(b,u){if(typeof exports=="object"&&typeof module=="object")module.exports=u();else if(typeof define=="function"&&define.amd)define([],u);else{var o=u();for(var a in o)(typeof exports=="object"?exports:b)[a]=o[a]}})(window,function(){return function(_){var b={};function u(o){if(b[o])return b[o].exports;var a=b[o]={i:o,l:!1,exports:{}};return _[o].call(a.exports,a,a.exports,u),a.l=!0,a.exports}return u.m=_,u.c=b,u.d=function(o,a,m){u.o(o,a)||Object.defineProperty(o,a,{enumerable:!0,get:m})},u.r=function(o){typeof Symbol!="undefined"&&Symbol.toStringTag&&Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(o,"__esModule",{value:!0})},u.t=function(o,a){if(a&1&&(o=u(o)),a&8||a&4&&typeof o=="object"&&o&&o.__esModule)return o;var m=Object.create(null);if(u.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:o}),a&2&&typeof o!="string")for(var P in o)u.d(m,P,function(q){return o[q]}.bind(null,P));return m},u.n=function(o){var a=o&&o.__esModule?function(){return o.default}:function(){return o};return u.d(a,"a",a),a},u.o=function(o,a){return Object.prototype.hasOwnProperty.call(o,a)},u.p="",u(u.s=1)}([function(_,b,u){"use strict";(function(o){var a=typeof o=="object"&&o&&o.Object===Object&&o;b.a=a}).call(this,u(2))},function(_,b,u){_.exports=u(3)},function(_,b){var u;u=function(){return this}();try{u=u||new Function("return this")()}catch(o){typeof window=="object"&&(u=window)}_.exports=u},function(_,b,u){"use strict";u.r(b);var o=typeof globalThis!="undefined"&&globalThis||typeof self!="undefined"&&self||typeof o!="undefined"&&o,a={searchParams:"URLSearchParams"in o,iterable:"Symbol"in o&&"iterator"in Symbol,blob:"FileReader"in o&&"Blob"in o&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in o,arrayBuffer:"ArrayBuffer"in o};function m(e){return e&&DataView.prototype.isPrototypeOf(e)}if(a.arrayBuffer)var P=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],q=ArrayBuffer.isView||function(e){return e&&P.indexOf(Object.prototype.toString.call(e))>-1};function R(e){if(typeof e!="string"&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||e==="")throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function B(e){return typeof e!="string"&&(e=String(e)),e}function U(e){var t={next:function(){var r=e.shift();return{done:r===void 0,value:r}}};return a.iterable&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach(function(t,r){this.append(r,t)},this):Array.isArray(e)?e.forEach(function(t){this.append(t[0],t[1])},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}d.prototype.append=function(e,t){e=R(e),t=B(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},d.prototype.delete=function(e){delete this.map[R(e)]},d.prototype.get=function(e){return e=R(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(R(e))},d.prototype.set=function(e,t){this.map[R(e)]=B(t)},d.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},d.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),U(e)},d.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),U(e)},d.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),U(e)},a.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);function I(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function N(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function ne(e){var t=new FileReader,r=N(t);return t.readAsArrayBuffer(e),r}function oe(e){var t=new FileReader,r=N(t);return t.readAsText(e),r}function ae(e){for(var t=new Uint8Array(e),r=new Array(t.length),i=0;i<t.length;i++)r[i]=String.fromCharCode(t[i]);return r.join("")}function M(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function $(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?typeof e=="string"?this._bodyText=e:a.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:a.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:a.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():a.arrayBuffer&&a.blob&&m(e)?(this._bodyArrayBuffer=M(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):a.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||q(e))?this._bodyArrayBuffer=M(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||(typeof e=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):a.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a.blob&&(this.blob=function(){var e=I(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=I(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else return this.blob().then(ne)}),this.text=function(){var e=I(this);if(e)return e;if(this._bodyBlob)return oe(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ae(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},a.formData&&(this.formData=function(){return this.text().then(ce)}),this.json=function(){return this.text().then(JSON.parse)},this}var fe=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function ue(e){var t=e.toUpperCase();return fe.indexOf(t)>-1?t:e}function v(e,t){if(!(this instanceof v))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var r=t.body;if(e instanceof v){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,!r&&e._bodyInit!=null&&(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new d(t.headers)),this.method=ue(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&r)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(r),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var i=/([?&])_=[^&]*/;if(i.test(this.url))this.url=this.url.replace(i,"$1_="+new Date().getTime());else{var n=/\?/;this.url+=(n.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}v.prototype.clone=function(){return new v(this,{body:this._bodyInit})};function ce(e){var t=new FormData;return e.trim().split("&").forEach(function(r){if(r){var i=r.split("="),n=i.shift().replace(/\+/g," "),s=i.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(s))}}),t}function le(e){var t=new d,r=e.replace(/\r?\n[\t ]+/g," ");return r.split("\r").map(function(i){return i.indexOf(`
`)===0?i.substr(1,i.length):i}).forEach(function(i){var n=i.split(":"),s=n.shift().trim();if(s){var c=n.join(":").trim();t.append(s,c)}}),t}$.call(v.prototype);function g(e,t){if(!(this instanceof g))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}$.call(g.prototype),g.prototype.clone=function(){return new g(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},g.error=function(){var e=new g(null,{status:0,statusText:""});return e.type="error",e};var he=[301,302,303,307,308];g.redirect=function(e,t){if(he.indexOf(t)===-1)throw new RangeError("Invalid status code");return new g(null,{status:t,headers:{location:e}})};var T=o.DOMException;try{new T}catch(e){T=function(t,r){this.message=t,this.name=r;var i=Error(t);this.stack=i.stack},T.prototype=Object.create(Error.prototype),T.prototype.constructor=T}function G(e,t){return new Promise(function(r,i){var n=new v(e,t);if(n.signal&&n.signal.aborted)return i(new T("Aborted","AbortError"));var s=new XMLHttpRequest;function c(){s.abort()}s.onload=function(){var f={status:s.status,statusText:s.statusText,headers:le(s.getAllResponseHeaders()||"")};f.url="responseURL"in s?s.responseURL:f.headers.get("X-Request-URL");var h="response"in s?s.response:s.responseText;setTimeout(function(){r(new g(h,f))},0)},s.onerror=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},s.ontimeout=function(){setTimeout(function(){i(new TypeError("Network request failed"))},0)},s.onabort=function(){setTimeout(function(){i(new T("Aborted","AbortError"))},0)};function l(f){try{return f===""&&o.location.href?o.location.href:f}catch(h){return f}}s.open(n.method,l(n.url),!0),n.credentials==="include"?s.withCredentials=!0:n.credentials==="omit"&&(s.withCredentials=!1),"responseType"in s&&(a.blob?s.responseType="blob":a.arrayBuffer&&n.headers.get("Content-Type")&&n.headers.get("Content-Type").indexOf("application/octet-stream")!==-1&&(s.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof d)?Object.getOwnPropertyNames(t.headers).forEach(function(f){s.setRequestHeader(f,B(t.headers[f]))}):n.headers.forEach(function(f,h){s.setRequestHeader(h,f)}),n.signal&&(n.signal.addEventListener("abort",c),s.onreadystatechange=function(){s.readyState===4&&n.signal.removeEventListener("abort",c)}),s.send(typeof n._bodyInit=="undefined"?null:n._bodyInit)})}G.polyfill=!0,o.fetch||(o.fetch=G,o.Headers=d,o.Request=v,o.Response=g);function de(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var D=de,pe=u(0),ye=typeof self=="object"&&self&&self.Object===Object&&self,be=pe.a||ye||Function("return this")(),z=be,me=function(){return z.Date.now()},C=me,ge=/\s/;function _e(e){for(var t=e.length;t--&&ge.test(e.charAt(t)););return t}var we=_e,ve=/^\s+/;function Te(e){return e&&e.slice(0,we(e)+1).replace(ve,"")}var Re=Te,Ae=z.Symbol,S=Ae,W=Object.prototype,Oe=W.hasOwnProperty,Ee=W.toString,A=S?S.toStringTag:void 0;function Pe(e){var t=Oe.call(e,A),r=e[A];try{e[A]=void 0;var i=!0}catch(s){}var n=Ee.call(e);return i&&(t?e[A]=r:delete e[A]),n}var Se=Pe,xe=Object.prototype,je=xe.toString;function qe(e){return je.call(e)}var Be=qe,Ue="[object Null]",Ie="[object Undefined]",V=S?S.toStringTag:void 0;function De(e){return e==null?e===void 0?Ie:Ue:V&&V in Object(e)?Se(e):Be(e)}var Ce=De;function ke(e){return e!=null&&typeof e=="object"}var Fe=ke,He="[object Symbol]";function Le(e){return typeof e=="symbol"||Fe(e)&&Ce(e)==He}var Ne=Le,J=0/0,Me=/^[-+]0x[0-9a-f]+$/i,$e=/^0b[01]+$/i,Ge=/^0o[0-7]+$/i,ze=parseInt;function We(e){if(typeof e=="number")return e;if(Ne(e))return J;if(D(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=D(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Re(e);var r=$e.test(e);return r||Ge.test(e)?ze(e.slice(2),r?2:8):Me.test(e)?J:+e}var X=We,Ve="Expected a function",Je=Math.max,Xe=Math.min;function Ke(e,t,r){var i,n,s,c,l,f,h=0,te=!1,O=!1,F=!0;if(typeof e!="function")throw new TypeError(Ve);t=X(t)||0,D(r)&&(te=!!r.leading,O="maxWait"in r,s=O?Je(X(r.maxWait)||0,t):s,F="trailing"in r?!!r.trailing:F);function H(p){var w=i,E=n;return i=n=void 0,h=p,c=e.apply(E,w),c}function st(p){return h=p,l=setTimeout(j,t),te?H(p):c}function nt(p){var w=p-f,E=p-h,se=t-w;return O?Xe(se,s-E):se}function re(p){var w=p-f,E=p-h;return f===void 0||w>=t||w<0||O&&E>=s}function j(){var p=C();if(re(p))return ie(p);l=setTimeout(j,nt(p))}function ie(p){return l=void 0,F&&i?H(p):(i=n=void 0,c)}function ot(){l!==void 0&&clearTimeout(l),h=0,i=f=n=l=void 0}function at(){return l===void 0?c:ie(C())}function L(){var p=C(),w=re(p);if(i=arguments,n=this,f=p,w){if(l===void 0)return st(f);if(O)return clearTimeout(l),l=setTimeout(j,t),H(f)}return l===void 0&&(l=setTimeout(j,t)),c}return L.cancel=ot,L.flush=at,L}var K=Ke;function Q(e){try{return window.wadiz.globals[e]}catch(t){return null}}function x(e){const t=Object.keys(e).filter(r=>!!e[r]).map(r=>[r,encodeURIComponent(e[r])].join("="));return t.length>0?`?${t.join("&")}`:""}var Qe=Object.defineProperty,Y=Object.getOwnPropertySymbols,Ye=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable,Z=(e,t,r)=>t in e?Qe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,k=(e,t)=>{for(var r in t||(t={}))Ye.call(t,r)&&Z(e,r,t[r]);if(Y)for(var r of Y(t))Ze.call(t,r)&&Z(e,r,t[r]);return e},et=(e,t,r)=>new Promise((i,n)=>{var s=f=>{try{l(r.next(f))}catch(h){n(h)}},c=f=>{try{l(r.throw(f))}catch(h){n(h)}},l=f=>f.done?i(f.value):Promise.resolve(f.value).then(s,c);l((r=r.apply(e,t)).next())});const y={PATH:"u",REFERRER:"r",USERID:"i",TAGID:"t",TARGET_URL:"tu",ACTION:"a"},ee=e=>{const t=e["data-ec-contenttype"],r=e["data-ec-list"],i=e["data-promo-acid"];let n="",s=r?"product":"promo";switch(t){case"STORE":n="Store_";break;case"COMING_SOON":n="Coming_";break;case"PREORDER":n="Preorder_";break}return r?s="product":i&&(s="promo"),`${n}${s}`};class tt{constructor(){this.host=Q("analyticsHost"),this.userId=Q("hashedUserName"),this.queue=[],this.referrer=document.referrer,this._send=K(this.send,250,{maxWait:1e3}),this.requests=[],this.pageUrl=null,this.lazyProcessRequests=K(this.processRequests,250,{maxWait:1e3}),this.init(),this.ga4Requests=[],this.ga4AnalyticsHost=null}setGA4AnalyticsHost(t){this.ga4AnalyticsHost=t}setReferrer(t){t&&this.referrer!==t&&(this.flush(),this.referrer=t)}flush(){this.queue.length&&this.send(null)}add(t={}){const r=k({},t);return this.queue.push(r),this._send(null)}send(){return et(this,arguments,function*(t={}){if(!this.host||t===null&&this.queue.length===0)return;const r={method:"GET",mode:"cors",credentials:"include"};try{const{pathname:i,search:n}=window.location,s=t||this.queue[this.queue.length-1];let c=null;const l=s==null?void 0:s[y.PATH];if(l)if(l.startsWith("/"))c=l;else{const h=new URL(l);c=h.pathname+h.search}const f={[y.PATH]:c||i+n,[y.USERID]:this.userId||""};if(this.referrer&&(f[y.REFERRER]=this.referrer),this.queue.length>0){t!==null&&this.queue.push(t),f[y.ACTION]="0000";const h=new FormData;h.append("actions",JSON.stringify(this.queue)),this.queue=[],Object.assign(r,{method:"POST",body:h})}else Object.assign(f,k(k({},t),f));yield fetch(`${this.host}/add${x(f)}`,r)}catch(i){}})}pageView({userId:t,referrer:r}={}){this.setReferrer(r);const i={[y.USERID]:t||""};this.send(i)}layerView({tagId:t,userId:r,referrer:i}={}){const{pathname:n,search:s}=window.location;this.setReferrer(i),this.flush();const c={[y.USERID]:r||"",[y.PATH]:`${t}?path=${n+s}`};this.send(c)}tagView({userId:t,tagId:r,targetUrl:i,path:n,referrer:s}={}){r&&(this.setReferrer(s),this.add({[y.ACTION]:"2010",[y.TAGID]:r,[y.TARGET_URL]:i,[y.USERID]:t||"",[y.PATH]:n}))}tagClick({userId:t,tagId:r,targetUrl:i,path:n,referrer:s}){r&&(this.setReferrer(s),this.send({[y.ACTION]:"2020",[y.TAGID]:r,[y.TARGET_URL]:i,[y.USERID]:t||"",[y.PATH]:n}))}init(){const t=()=>{document.visibilityState==="hidden"&&this.processRequests()};document.addEventListener("visibilitychange",t)}sendRequests(t,r){fetch(t,{method:"POST",mode:"cors",credentials:"include",body:r,keepalive:!0}).catch(i=>{var n;return(n=window.Sentry)==null?void 0:n.captureMessage("waditag error sendRequests")})}processRequests(){const t={url:this.pageUrl,id:this.userId||""};if(this.requests.length>0){const r=`${this.host}/v2/add${x(t)}`,i=new FormData;i.append("action","0000"),i.append("actions",JSON.stringify(this.requests.splice(0,this.requests.length))),this.sendRequests(r,i)}if(this.ga4AnalyticsHost&&this.ga4Requests.length>0){const r=`${this.ga4AnalyticsHost}/v2/add${x(t)}`,i=new FormData;i.append("action","0000"),i.append("actions",JSON.stringify(this.ga4Requests.splice(0,this.ga4Requests.length))),this.sendRequests(r,i)}}addToRequests({pageUrl:t,request:r,lazy:i=!1,isGA4:n}){this.pageUrl&&this.pageUrl!==t&&this.processRequests(),this.pageUrl=t,n?this.ga4Requests.push(r):this.requests.push(r),this.lazyProcessRequests(),i?this.lazyProcessRequests():this.processRequests()}gaCommon({pageUrl:t,category:r,action:i,label:n}){this.addToRequests({pageUrl:t,request:{action:i,tagid:r,taglabel:n}})}impression({pageUrl:t,href:r,detail:i,isGA4:n}){let s,c;n?(s=i.item_list_id?"view_item_list":"view_promotion",c=i.item_list_id||i.creative_slot):(s=`${ee(i)}Impression`,c=i["data-ec-list"]||i["data-promo-position"]),this.addToRequests({pageUrl:t,isGA4:n,lazy:!0,request:{action:s,tagid:c,tagurl:r,detail:i}})}click({pageUrl:t,href:r,detail:i,isGA4:n}){let s,c;n?(s=i.item_list_id?"select_item":"select_promotion",c=i.item_list_id||i.creative_slot):(s=`${ee(i)}Click`,c=i["data-ec-list"]||i["data-promo-position"]),this.addToRequests({pageUrl:t,isGA4:n,request:{action:s,tagid:c,tagurl:r,detail:i}})}pageview({pageUrl:t}){this.processRequests(),this.pageUrl=t;const r={url:this.pageUrl,id:this.userId||""},i=`${this.host}/v2/add${x(r)}`;fetch(i,{method:"GET",mode:"cors",credentials:"include"}).catch(n=>{var s;return(s=window.Sentry)==null?void 0:s.captureMessage("waditag error pageview")})}send2(t,r){switch(t){case"gaCommon":this.gaCommon(r);break;case"impression":this.impression(r);break;case"click":this.click(r);break;case"pageview":this.pageview(r);break;default:break}}}var rt=tt,it=rt;window.wadiz=window.wadiz||{},window.wadiz.analytics=new it}])});

//# sourceMappingURL=client.js.map